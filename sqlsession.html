<!DOCTYPE html>


<!--
 | Generated by Apache Maven Doxia Site Renderer 2.0.0 from target/site-src/markdown/sqlsession.md at 27 May 2025
 | Rendered using Apache Maven Fluido Skin 2.1.0
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 2.0.0" />
    <title>mybatis-spring</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-2.1.0.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
    <script src="./js/apache-maven-fluido-2.1.0.min.js"></script>
  </head>
  <body>
    <div class="container-fluid container-fluid-top">
      <header>
        <div id="banner">
          <div class="pull-left"></div>
          <div class="pull-right"><div id="bannerRight"><h1><a href="https://blog.mybatis.org/"><img src="../images/mybatis-logo.png" alt="MyBatis logo" /> MyBatis</a></h1></div></div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
        <li id="publishDate">Last Published: 11 Aug 2024<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 3.0.5-SNAPSHOT</li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">Reference Documentation</li>
    <li><a href="index.html">Introduction</a></li>
    <li><a href="getting-started.html">Getting Started</a></li>
    <li><a href="factorybean.html">SqlSessionFactoryBean</a></li>
    <li><a href="transactions.html"><span class="icon-chevron-right"></span>Transactions</a></li>
    <li class="active"><a><span class="icon-chevron-down"></span>Using an SqlSession</a>
     <ul class="nav nav-list">
      <li><a href="sqlsession.html#SqlSessionTemplate">SqlSessionTemplate</a></li>
      <li><a href="sqlsession.html#SqlSessionDaoSupport">SqlSessionDaoSupport</a></li>
     </ul></li>
    <li><a href="mappers.html"><span class="icon-chevron-right"></span>Injecting Mappers</a></li>
    <li><a href="boot.html">Spring Boot</a></li>
    <li><a href="using-api.html">Using the MyBatis API</a></li>
    <li><a href="batch.html">Spring Batch</a></li>
    <li><a href="sample.html">Sample Code</a></li>
   <li class="nav-header">Project Documentation</li>
    <li><a href="project-info.html"><span class="icon-chevron-right"></span>Project Information</a></li>
    <li><a href="project-reports.html"><span class="icon-chevron-right"></span>Project Reports</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
<a href="https://maven.apache.org/" class="builtBy" target="_blank"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn" class="span10">
<p></p><section><a id="Using_an_SqlSession"></a>
<h1>Using an SqlSession</h1>
<p>In MyBatis you use the <code>SqlSessionFactory</code> to create an <code>SqlSession</code>.
Once you have a session, you use it to execute your mapped statements, commit or rollback connections and finally, when it is no longer needed, you close the session.
With MyBatis-Spring you don't need to use <code>SqlSessionFactory</code> directly because your beans can be injected with a thread safe <code>SqlSession</code> that automatically commits, rollbacks and closes the session based on Spring's transaction configuration.</p><section><a id="SqlSessionTemplate"></a>
<h2>SqlSessionTemplate</h2>
<p><code>SqlSessionTemplate</code> is the heart of MyBatis-Spring. It implements <code>SqlSession</code> and is meant to be a drop-in replacement for any existing use of <code>SqlSession</code> in your code.
<code>SqlSessionTemplate</code> is thread safe and can be shared by multiple DAOs or mappers.</p>
<p>When calling SQL methods, including any method from Mappers returned by <code>getMapper()</code>, <code>SqlSessionTemplate</code> will ensure that the <code>SqlSession</code> used is the one associated with the current Spring transaction.
In addition, it manages the session life-cycle, including closing, committing or rolling back the session as necessary. It will also translate MyBatis exceptions into Spring <code>DataAccessException</code>s.</p>
<p><code>SqlSessionTemplate</code> should <strong>always</strong> be used instead of default MyBatis implementation <code>DefaultSqlSession</code> because the template can participate in Spring transactions and is thread safe for use by multiple injected mapper classes.
Switching between the two classes in the same application can cause data integrity issues.</p>
<p>A <code>SqlSessionTemplate</code> can be constructed using an <code>SqlSessionFactory</code> as a constructor argument.</p>

<pre class="prettyprint"><code class="language-xml">&lt;bean id=&quot;sqlSession&quot; class=&quot;org.mybatis.spring.SqlSessionTemplate&quot;&gt;
  &lt;constructor-arg index=&quot;0&quot; ref=&quot;sqlSessionFactory&quot; /&gt;
&lt;/bean&gt;
</code></pre>

<pre class="prettyprint"><code class="language-java">@Configuration
public class MyBatisConfig {
  @Bean
  public SqlSessionTemplate sqlSession() throws Exception {
    return new SqlSessionTemplate(sqlSessionFactory());
  }
}
</code></pre>
<p>This bean can now be injected directly in your DAO beans. You need a <code>SqlSession</code> property in your bean like the following</p>

<pre class="prettyprint"><code class="language-java">public class UserDaoImpl implements UserDao {

  private SqlSession sqlSession;

  public void setSqlSession(SqlSession sqlSession) {
    this.sqlSession = sqlSession;
  }

  public User getUser(String userId) {
    return sqlSession.selectOne(&quot;org.mybatis.spring.sample.mapper.UserMapper.getUser&quot;, userId);
  }
}
</code></pre>
<p>And inject the <code>SqlSessionTemplate</code> as follows</p>

<pre class="prettyprint"><code class="language-xml">&lt;bean id=&quot;userDao&quot; class=&quot;org.mybatis.spring.sample.dao.UserDaoImpl&quot;&gt;
  &lt;property name=&quot;sqlSession&quot; ref=&quot;sqlSession&quot; /&gt;
&lt;/bean&gt;
</code></pre>
<p><code>SqlSessionTemplate</code> has also a constructor that takes an <code>ExecutorType</code> as an argument. This allows you to construct, for example, a batch <code>SqlSession</code> by using the following in Spring's configuration file:</p>

<pre class="prettyprint"><code class="language-xml">&lt;bean id=&quot;sqlSession&quot; class=&quot;org.mybatis.spring.SqlSessionTemplate&quot;&gt;
  &lt;constructor-arg index=&quot;0&quot; ref=&quot;sqlSessionFactory&quot; /&gt;
  &lt;constructor-arg index=&quot;1&quot; value=&quot;BATCH&quot; /&gt;
&lt;/bean&gt;
</code></pre>

<pre class="prettyprint"><code class="language-java">@Configuration
public class MyBatisConfig {
  @Bean
  public SqlSessionTemplate sqlSession() throws Exception {
    return new SqlSessionTemplate(sqlSessionFactory(), ExecutorType.BATCH);
  }
}
</code></pre>
<p>Now all your statements will be batched so the following could be coded in a DAO</p>

<pre class="prettyprint"><code class="language-java">public class UserService {
  private final SqlSession sqlSession;
  public UserService(SqlSession sqlSession) {
    this.sqlSession = sqlSession;
  }
  public void insertUsers(List&lt;User&gt; users) {
    for (User user : users) {
      sqlSession.insert(&quot;org.mybatis.spring.sample.mapper.UserMapper.insertUser&quot;, user);
    }
  }
}
</code></pre>
<p>Note that this configuration style only needs to be used if the desired execution method differs from the default set for the <code>SqlSessionFactory</code>.</p>
<p>The caveat to this form is that there <strong>cannot</strong> be an existing transaction running with a different ExecutorType when this method is called.
Either ensure that calls to <code>SqlSessionTemplate</code>s with different executor types run in a separate transaction (e.g. with <code>PROPAGATION_REQUIRES_NEW</code>) or completely outside of a transaction.</p></section><section><a id="SqlSessionDaoSupport"></a>
<h2>SqlSessionDaoSupport</h2>
<p><code>SqlSessionDaoSupport</code> is an abstract support class that provides you with a <code>SqlSession</code>. Calling <code>getSqlSession()</code> you will get a <code>SqlSessionTemplate</code> which can then be used to execute SQL methods, like the following:</p>

<pre class="prettyprint"><code class="language-java">public class UserDaoImpl extends SqlSessionDaoSupport implements UserDao {
  public User getUser(String userId) {
    return getSqlSession().selectOne(&quot;org.mybatis.spring.sample.mapper.UserMapper.getUser&quot;, userId);
  }
}
</code></pre>
<p>Usually <code>MapperFactoryBean</code> is preferred to this class, since it requires no extra code. But, this class is useful if you need to do other non-MyBatis work in your DAO and concrete classes are required.</p>
<p><code>SqlSessionDaoSupport</code> requires either an <code>sqlSessionFactory</code> or an <code>sqlSessionTemplate</code> property to be set. If both properties are set, the <code>sqlSessionFactory</code> is ignored.</p>
<p>Assuming a class <code>UserDaoImpl</code> that subclasses <code>SqlSessionDaoSupport</code>, it can be configured in Spring like the following:</p>

<pre class="prettyprint"><code class="language-xml">&lt;bean id=&quot;userDao&quot; class=&quot;org.mybatis.spring.sample.dao.UserDaoImpl&quot;&gt;
  &lt;property name=&quot;sqlSessionFactory&quot; ref=&quot;sqlSessionFactory&quot; /&gt;
&lt;/bean&gt;
</code></pre></section></section>        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>©      2010–2025
<a href="https://www.mybatis.org/">MyBatis.org</a>
</p>
        </div>
      </div>
    </footer>
  </body>
</html>
