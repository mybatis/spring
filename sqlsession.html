<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at Mar 24, 2013
 | Rendered using Apache Maven Fluido Skin 1.3.0
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="The MyBatis Team" />
    <meta name="Date-Revision-yyyymmdd" content="20130324" />
    <meta http-equiv="Content-Language" content="en" />
    <title>MyBatis - 
    MyBatis-Spring | Using an SqlSession</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.3.0.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.3.0.min.js"></script>

    
            </head>
        <body class="topBarDisabled">
          
        
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>MyBatis-Spring</h2>
                </div>
                      </div>
        <div class="pull-right">                                <a href="../" id="bannerRight" title="MyBatis logo">
                                                                                        <img src="http://mybatis.github.com/images/mybatis-logo.png"  alt="MyBatis logo"/>
                </a>
      </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                  <li id="publishDate">Last Published: 24 March 2013</li>
                  <li class="divider">|</li> <li id="projectVersion">Version: 1.2.1-SNAPSHOT</li>
                      
                
                    
      
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">Reference Documentation</li>
                                
      <li>
    
                          <a href="index.html" title="Introduction">
          <i class="none"></i>
        Introduction</a>
            </li>
                  
      <li>
    
                          <a href="getting-started.html" title="Getting Started">
          <i class="none"></i>
        Getting Started</a>
            </li>
                  
      <li>
    
                          <a href="factorybean.html" title="SqlSessionFactoryBean">
          <i class="none"></i>
        SqlSessionFactoryBean</a>
            </li>
                                                                                                        
      <li>
    
                          <a href="transactions.html" title="Transactions">
          <i class="icon-chevron-right"></i>
        Transactions</a>
                  </li>
                                                                                          
      <li class="active">
    
            <a href="#"><i class="icon-chevron-down"></i>Using an SqlSession</a>
                  <ul class="nav nav-list">
                      
      <li>
    
                          <a href="sqlsession.html#SqlSessionTemplate" title="SqlSessionTemplate">
          <i class="none"></i>
        SqlSessionTemplate</a>
            </li>
                      
      <li>
    
                          <a href="sqlsession.html#SqlSessionDaoSupport" title="SqlSessionDaoSupport">
          <i class="none"></i>
        SqlSessionDaoSupport</a>
            </li>
              </ul>
        </li>
                                                                                      
      <li>
    
                          <a href="mappers.html" title="Injecting Mappers">
          <i class="icon-chevron-right"></i>
        Injecting Mappers</a>
                  </li>
                  
      <li>
    
                          <a href="using-api.html" title="Using the MyBatis API">
          <i class="none"></i>
        Using the MyBatis API</a>
            </li>
                  
      <li>
    
                          <a href="batch.html" title="Spring Batch">
          <i class="none"></i>
        Spring Batch</a>
            </li>
                  
      <li>
    
                          <a href="sample.html" title="Sample Code">
          <i class="none"></i>
        Sample Code</a>
            </li>
                              <li class="nav-header">Project Documentation</li>
                                                                                                                                                                                                                                                                                                          
      <li>
    
                          <a href="project-info.html" title="Project Information">
          <i class="icon-chevron-right"></i>
        Project Information</a>
                  </li>
                                                                                                                                                                                                                                                        
      <li>
    
                          <a href="project-reports.html" title="Project Reports">
          <i class="icon-chevron-right"></i>
        Project Reports</a>
                  </li>
            </ul>
                
                    
                
          <hr class="divider" />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            <!-- Copyright 2010-2012 The MyBatis Team

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License. --><!-- version: $Id$ -->

  
    <div class="section"><h2>Using an SqlSession<a name="Using_an_SqlSession"></a></h2>
      <p>
        In MyBatis you use the <tt>SqlSessionFactory</tt> to create an
        <tt>SqlSession</tt>. Once you have a session, you use it to
        execute your mapped statements, commit or rollback connections and
        finally, when it is no longer needed, you close the session. With
        MyBatis-Spring you don't need to use <tt>SqlSessionFactory</tt>
        directly because your beans can be injected with a thread safe
        <tt>SqlSession</tt> that automatically commits, rollbacks and
        closes the session based on Spring's transaction configuration.
      </p>  
    
    <div class="section"><h3>SqlSessionTemplate<a name="SqlSessionTemplate"></a></h3>
      <p>
        <tt>SqlSessionTemplate</tt> is the heart of MyBatis-Spring.
        It implements <tt>SqlSession</tt> and is meant to be a drop-in replacement
        for any existing use of <tt>SqlSession</tt> in your code.
        <tt>SqlSessionTemplate</tt> is thread safe and can be shared
        by multiple DAOs or mappers.
      </p>

      <p>
        When calling SQL methods, including any method from Mappers returned by
        <tt>getMapper()</tt>, <tt>SqlSessionTemplate</tt>
        will ensure that the <tt>SqlSession</tt> used is the one
        associated with the current Spring transaction. In addition, it manages
        the session life-cycle, including closing, committing or rolling back the
        session as necessary. It will also translate MyBatis exceptions
        into Spring <tt>DataAccessException</tt>s.
      </p>

      <p>
        <tt>SqlSessionTemplate</tt> should <b>always</b>
        be used instead of default MyBatis implementation <tt>DefaultSqlSession</tt>
        because the template can participate in Spring transactions and is thread safe for use by
        multiple injected mapper classes. Switching between the two classes in the
        same application can cause data integrity issues.
      </p>

      <p>
        A <tt>SqlSessionTemplate</tt> can be constructed
        using an <tt>SqlSessionFactory</tt> as a constructor argument.
      </p>
        <div class="source"><pre class="prettyprint">&lt;bean id=&quot;sqlSession&quot; class=&quot;org.mybatis.spring.SqlSessionTemplate&quot;&gt;
  &lt;constructor-arg index=&quot;0&quot; ref=&quot;sqlSessionFactory&quot; /&gt;
&lt;/bean&gt;</pre></div>        
     
      <p>
        This bean can now be injected directly in your DAO beans. You need a
        <tt>SqlSession</tt> property in your bean like the following
      </p>
        <div class="source"><pre class="prettyprint">public class UserDaoImpl implements UserDao {

  private SqlSession sqlSession;

  public void setSqlSession(SqlSession sqlSession) {
    this.sqlSession = sqlSession;
  }

  public User getUser(String userId) {
    return (User) sqlSession.selectOne(&quot;org.mybatis.spring.sample.mapper.UserMapper.getUser&quot;, userId);
  }
}</pre></div>
      <p>
        And inject the <tt>SqlSessionTemplate</tt> as follows
      </p>      
      <div class="source"><pre class="prettyprint">&lt;bean id=&quot;userDao&quot; class=&quot;org.mybatis.spring.sample.dao.UserDaoImpl&quot;&gt;
  &lt;property name=&quot;sqlSession&quot; ref=&quot;sqlSession&quot; /&gt;
&lt;/bean&gt;</pre></div>
      
      <p>
        <tt>SqlSessionTemplate</tt> has also a constructor that takes
        an <tt>ExecutorType</tt> as an argument. This allows you to
        construct, for example, a batch <tt>SqlSession</tt> by using
        the following in Spring's configuration xml:
      </p>
        <div class="source"><pre class="prettyprint">&lt;bean id=&quot;sqlSession&quot; class=&quot;org.mybatis.spring.SqlSessionTemplate&quot;&gt;
  &lt;constructor-arg index=&quot;0&quot; ref=&quot;sqlSessionFactory&quot; /&gt;
  &lt;constructor-arg index=&quot;1&quot; value=&quot;BATCH&quot; /&gt;
&lt;/bean&gt;</pre></div>
      <p>
        Now all your statements will be batched so the following could be coded
        in a DAO
      </p>
        <div class="source"><pre class="prettyprint">public void insertUsers(User[] users) {
   for (User user : users) {
     sqlSession.insert(&quot;org.mybatis.spring.sample.mapper.UserMapper.insertUser&quot;, user);
   }
 }</pre></div> 
  
      <p>
        Note that this configuration style only needs to be used if the desired
        execution method differs from the default set for the
        <tt>SqlSessionFactory</tt>.
      </p>

      <p>
        The caveat to this form is that
        there <b>cannot</b> be an existing transaction running with
        a different ExecutorType when this method is called. Either ensure that
        calls to <tt>SqlSessionTemplate</tt>s with different executor
        types run in a separate transaction (e.g. with PROPAGATION_REQUIRES_NEW) or
        completely outside of a transaction.
      </p>
    </div>

    <div class="section"><h3>SqlSessionDaoSupport<a name="SqlSessionDaoSupport"></a></h3>
      <p>
        <tt>SqlSessionDaoSupport</tt> is an abstract support class that
        provides you with a <tt>SqlSession</tt>. Calling
        <tt>getSqlSession()</tt> you will get a <tt>SqlSessionTemplate</tt>
        which can then be used to execute SQL methods, like the following:
      </p>
        <div class="source"><pre class="prettyprint">public class UserDaoImpl extends SqlSessionDaoSupport implements UserDao {
  public User getUser(String userId) {
    return (User) getSqlSession().selectOne(&quot;org.mybatis.spring.sample.mapper.UserMapper.getUser&quot;, userId);
  }
}</pre></div>
      <p>
        Usually <tt>MapperFactoryBean</tt> is preferred to this class,
        since it requires no extra code. But, this class is useful if you need
        to do other non-MyBatis work in your DAO and concrete classes are
        required.
      </p>

      <p>
        <tt>SqlSessionDaoSupport</tt> requires either an
        <tt>sqlSessionFactory</tt> or an <tt>sqlSessionTemplate</tt>
        property to be set.
        If both properties are set, the <tt>sqlSessionFactory</tt> is ignored.
      </p>

      <p>
        Assuming a class <tt>UserDaoImpl</tt> that subclasses
        <tt>SqlSessionDaoSupport</tt>, it can be configured in Spring
        like the following:
      </p>
        <div class="source"><pre class="prettyprint">&lt;bean id=&quot;userMapper&quot; class=&quot;org.mybatis.spring.sample.mapper.UserDaoImpl&quot;&gt;
  &lt;property name=&quot;sqlSessionFactory&quot; ref=&quot;sqlSessionFactory&quot; /&gt;
&lt;/bean&gt;</pre></div>
      </div>
    </div>
  

                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
              <div class="row span12">Copyright &copy;                    2010-2013
                        <a href="http://www.mybatis.org/">MyBatis.org</a>.
            All Rights Reserved.      
                    
      </div>

        
        
                </div>
    </footer>
  </body>
</html>
