<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.8.1 from src/site/xdoc/transactions.xml at 07 April 2019
 | Rendered using Apache Maven Fluido Skin 1.7
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="Hunter Presnall" />
    <meta name="author" content="Eduardo Macarron" />
    <meta name="Date-Revision-yyyymmdd" content="20190407" />
    <meta http-equiv="Content-Language" content="en" />
    <title>mybatis-spring &#x2013; MyBatis-Spring | Transactions</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.7.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
    <script type="text/javascript" src="./js/apache-maven-fluido-1.7.min.js"></script>
  </head>
  <body class="topBarDisabled">
    <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><div id="bannerLeft"><h2>mybatis-spring</h2>
</div>
</div>
        <div class="pull-right"><a href="../" id="bannerRight" title="MyBatis logo"><img src="../images/mybatis-logo.png"  alt="MyBatis logo"/></a></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
        <li id="publishDate">Last Published: 07 April 2019<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 2.0.1</li>
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
    <ul class="nav nav-list">
      <li class="nav-header">Reference Documentation</li>
    <li><a href="index.html" title="Introduction"><span class="none"></span>Introduction</a></li>
    <li><a href="getting-started.html" title="Getting Started"><span class="none"></span>Getting Started</a></li>
    <li><a href="factorybean.html" title="SqlSessionFactoryBean"><span class="none"></span>SqlSessionFactoryBean</a></li>
    <li class="active"><a href="#"><span class="icon-chevron-down"></span>Transactions</a>
    <ul class="nav nav-list">
    <li><a href="transactions.html#configuration" title="Standard Configuration"><span class="none"></span>Standard Configuration</a></li>
    <li><a href="transactions.html#container" title="Container Managed Transactions"><span class="none"></span>Container Managed Transactions</a></li>
    <li><a href="transactions.html#programmatic" title="Programmatic"><span class="none"></span>Programmatic</a></li>
    </ul>
</li>
    <li><a href="sqlsession.html" title="Using an SqlSession"><span class="icon-chevron-right"></span>Using an SqlSession</a></li>
    <li><a href="mappers.html" title="Injecting Mappers"><span class="icon-chevron-right"></span>Injecting Mappers</a></li>
    <li><a href="boot.html" title="Spring Boot"><span class="none"></span>Spring Boot</a></li>
    <li><a href="using-api.html" title="Using the MyBatis API"><span class="none"></span>Using the MyBatis API</a></li>
    <li><a href="batch.html" title="Spring Batch"><span class="none"></span>Spring Batch</a></li>
    <li><a href="sample.html" title="Sample Code"><span class="none"></span>Sample Code</a></li>
      <li class="nav-header">Project Documentation</li>
    <li><a href="project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a></li>
    <li><a href="project-reports.html" title="Project Reports"><span class="icon-chevron-right"></span>Project Reports</a></li>
</ul>
          <hr />
          <div id="poweredBy">
            <div class="clear"></div>
            <div class="clear"></div>
            <div class="clear"></div>
            <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span10" >


  
    <div class="section">
<h2><a name="Transactions"></a>Transactions</h2>
      
<p>
        One of the primary reasons for using MyBatis-Spring is that it allows
        MyBatis to participate in Spring transactions. Rather than create a new
        transaction manager specific to MyBatis, MyBatis-Spring leverages the
        existing <tt>DataSourceTransactionManager</tt> in Spring.
      </p>
      
<p>
        Once a Spring transaction manager is configured, you can configure
        transactions in Spring as you normally would. Both
        <tt>@Transactional</tt> annotations and AOP style
        configurations are supported. A single <tt>SqlSession</tt>
        object will be created and used for the duration of the transaction. This
        session will be committed or rolled back as appropriate when then
        transaction completes.
      </p>
      
<p>
        MyBatis-Spring will transparently manage transactions once they are set up.
        There is no need for additional code in your DAO classes.
      </p>
  
    <a name="configuration"></a>
<div class="section" id="configuration">
<h3><a name="Standard_Configuration"></a>Standard Configuration</h3>
      
<p>
        To enable Spring transaction processing, simply create a
        <tt>DataSourceTransactionManager</tt> in your Spring
        configuration file:
      </p>

        
<div class="source"><pre class="prettyprint">
&lt;bean id=&quot;transactionManager&quot; class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt;
  &lt;constructor-arg ref=&quot;dataSource&quot; /&gt;
&lt;/bean&gt;</pre></div>

      
<div class="source"><pre class="prettyprint">
@Bean
public DataSourceTransactionManager transactionManager() {
  return new DataSourceTransactionManager(dataSource());
}</pre></div>

      
<p>
        The <tt>DataSource</tt> specified can be any JDBC
        <tt>DataSource</tt> you would normally
        use with Spring. This includes connection pools as well as <tt>DataSource</tt>s
        obtained through JNDI lookups.
      </p>
      
<p>
        Note that the <tt>DataSource</tt> specified for the transaction
        manager <b>must</b> be the same one that is used to create
        the <tt>SqlSessionFactoryBean</tt> or transaction management will
        not work.
      </p>
    </div>

    <a name="container"></a>
<div class="section" id="container">
<h3><a name="Container_Managed_Transactions"></a>Container Managed Transactions</h3>
      
<p>
        If you are using a JEE container and would like Spring to participate in
        container managed transactions (CMT), then Spring should be configured
        with a <tt>JtaTransactionManager</tt> or one of its container
        specific subclasses. The easiest way to do this is to use the Spring
        transaction namespace or the <tt>JtaTransactionManagerFactoryBean</tt>:
      </p>
      
<div class="source"><pre class="prettyprint">&lt;tx:jta-transaction-manager /&gt;</pre></div>

      
<div class="source"><pre class="prettyprint">
@Bean
public JtaTransactionManager transactionManager() {
  return new JtaTransactionManagerFactoryBean().getObject();
}</pre></div>

      
<p>
        In this configuration, MyBatis will behave like any other Spring
        transactional resource configured with CMT. Spring will automatically use
        any existing container transaction and attach an <tt>SqlSession</tt> to it. If no
        transaction is started and one is needed based on the transaction
        configuration, Spring will start a new container managed transaction.
      </p>
      
<p>
        Note that if you want to use CMT and do <b>not</b> want to
        use Spring transaction management, you <b>must not</b>
        configure any Spring transaction manager and you <b>must</b>
        also configure the <tt>SqlSessionFactoryBean</tt> to use the base
        MyBatis <tt>ManagedTransactionFactory</tt>:
      </p>
      
<div class="source"><pre class="prettyprint">&lt;bean id=&quot;sqlSessionFactory&quot; class=&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;&gt;
  &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot; /&gt;
  &lt;property name=&quot;transactionFactory&quot;&gt;
    &lt;bean class=&quot;org.apache.ibatis.transaction.managed.ManagedTransactionFactory&quot; /&gt;
  &lt;/property&gt;  
&lt;/bean&gt;</pre></div>

      
<div class="source"><pre class="prettyprint">
@Bean
public SqlSessionFactory sqlSessionFactory() {
  SqlSessionFactoryBean factoryBean = new SqlSessionFactoryBean();
  factoryBean.setDataSource(dataSource());
  factoryBean.setTransactionFactory(new ManagedTransactionFactory());
  return factoryBean.getObject();
}</pre></div>
    </div>

    <a name="programmatic"></a>
<div class="section" id="programmatic">
<h3><a name="Programmatic_Transaction_Management"></a>Programmatic Transaction Management</h3>
      
<p>
        MyBatis <tt>SqlSession</tt> provides you with specific methods to handle
        transactions programmatically. But when using MyBatis-Spring your beans will be
        injected with a Spring managed <tt>SqlSession</tt> or a Spring managed mapper.
        That means that Spring will <b>always</b> handle your transactions.
      </p>
      
<p>
        You cannot call <tt>SqlSession.commit()</tt>, <tt>SqlSession.rollback()</tt>
        or <tt>SqlSession.close()</tt> over a Spring managed <tt>SqlSession</tt>.
        If you try to do so, a <tt>UnsupportedOperationException</tt> exception
        will be thrown. Note these methods are not exposed in injected mapper classes.
      </p>
      
<p>
        Regardless of your JDBC connection's autocommit setting, any execution of a
        <tt>SqlSession</tt> data method or any call to a mapper
        method outside a Spring transaction will be automatically committed.
      </p>
      
<p>
        If you want to control your transactions programmatically please refer to
        <a class="externalLink" href="https://docs.spring.io/spring/docs/current/spring-framework-reference/data-access.html#transaction-programmatic">the Spring reference document(Data Access -Programmatic transaction management-)</a>.
        This code shows how to handle a transaction manually using the <tt>PlatformTransactionManager</tt>.
      </p>
        
<div class="source"><pre class="prettyprint">
TransactionStatus txStatus =
    transactionManager.getTransaction(new DefaultTransactionDefinition());
try {
  userMapper.insertUser(user);
} catch (Exception e) {
  transactionManager.rollback(txStatus);
  throw e;
}
transactionManager.commit(txStatus);</pre></div>

      
<p>
        You can omit to call the <tt>commit</tt> and <tt>rollback</tt> method using the <tt>TransactionTemplate</tt>.
      </p>

      
<div class="source"><pre class="prettyprint">
TransactionTemplate transactionTemplate = new TransactionTemplate(transactionManager);
transactionTemplate.execute(txStatus -&gt; {
  userMapper.insertUser(user);
  return null;
});</pre></div>

      
<p>
        Notice that this code uses a mapper, but it will also work with a <tt>SqlSession</tt>.
      </p>
      </div>
    </div>
  

        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &copy;2010&#x2013;2019
<a href="http://www.mybatis.org/">MyBatis.org</a>.
All rights reserved.</p>
        </div>
      </div>
    </footer>
  </body>
</html>
