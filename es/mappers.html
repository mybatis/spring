<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 23-feb-2013
 | Rendered using Apache Maven Fluido Skin 1.3.0
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="es" lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="The MyBatis Team" />
    <meta name="Date-Revision-yyyymmdd" content="20130223" />
    <meta http-equiv="Content-Language" content="es" />
    <title>MyBatis - 
    MyBatis-Spring | Inyectar mappers</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.3.0.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.3.0.min.js"></script>

    
            </head>
        <body class="topBarDisabled">
          
        
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>MyBatis-Spring</h2>
                </div>
                      </div>
        <div class="pull-right">                                <a href="../" id="bannerRight" title="MyBatis logo">
                                                                                        <img src="http://mybatis.github.com/images/mybatis-logo.png"  alt="MyBatis logo"/>
                </a>
      </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                  <li id="publishDate">Publicado el: 23 febrero 2013</li>
                  <li class="divider">|</li> <li id="projectVersion">Versión: 1.2.1-SNAPSHOT</li>
                      
                
                    
      
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">Manual de Referencia</li>
                                
      <li>
    
                          <a href="index.html" title="Introducción">
          <i class="none"></i>
        Introducción</a>
            </li>
                  
      <li>
    
                          <a href="getting-started.html" title="Primeros pasos">
          <i class="none"></i>
        Primeros pasos</a>
            </li>
                  
      <li>
    
                          <a href="factorybean.html" title="SqlSessionFactoryBean">
          <i class="none"></i>
        SqlSessionFactoryBean</a>
            </li>
                                                                                                        
      <li>
    
                          <a href="transactions.html" title="Transacciones">
          <i class="icon-chevron-right"></i>
        Transacciones</a>
                  </li>
                                                                                      
      <li>
    
                          <a href="sqlsession.html" title="Uso de SqlSession">
          <i class="icon-chevron-right"></i>
        Uso de SqlSession</a>
                  </li>
                                                                                          
      <li class="active">
    
            <a href="#"><i class="icon-chevron-down"></i>Inyección de Mappers</a>
                  <ul class="nav nav-list">
                      
      <li>
    
                          <a href="mappers.html#register" title="Registrar un mapper">
          <i class="none"></i>
        Registrar un mapper</a>
            </li>
                      
      <li>
    
                          <a href="mappers.html#scan" title="Escanear mappers">
          <i class="none"></i>
        Escanear mappers</a>
            </li>
              </ul>
        </li>
                  
      <li>
    
                          <a href="using-api.html" title="Uso del API de MyBatis">
          <i class="none"></i>
        Uso del API de MyBatis</a>
            </li>
                  
      <li>
    
                          <a href="batch.html" title="Spring Batch">
          <i class="none"></i>
        Spring Batch</a>
            </li>
                  
      <li>
    
                          <a href="sample.html" title="Código de ejemplo">
          <i class="none"></i>
        Código de ejemplo</a>
            </li>
                              <li class="nav-header">Documentación del proyecto</li>
                                                                                                                                                                                                                                                                                        
      <li>
    
                          <a href="project-info.html" title="Información del proyecto">
          <i class="icon-chevron-right"></i>
        Información del proyecto</a>
                  </li>
                                                                                                                                                                                                                                                        
      <li>
    
                          <a href="project-reports.html" title="Informes del proyecto">
          <i class="icon-chevron-right"></i>
        Informes del proyecto</a>
                  </li>
            </ul>
                
                    
                
          <hr class="divider" />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Generado por Maven" class="poweredBy">
        <img class="builtBy" alt="Generado por Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            <!-- Copyright 2010-2012 The MyBatis Team

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License. --><!-- version: $Id$ -->

  
    <div class="section"><h2>Inyectar mappers<a name="Inyectar_mappers"></a></h2>
      <p>
        En lugar de codificar DAOs (data access objects) manualmente usando la clase
        <tt>SqlSessionDaoSupport</tt> o <tt>SqlSessionTemplate</tt>, Mybatis-Spring 
		puede crear un mapper thread-safe que puedes inyectar directamente en otros beans.
      </p>
      
      <div class="source"><pre class="prettyprint">&lt;bean id=&quot;fooService&quot; class=&quot;org.mybatis.spring.sample.mapper.FooServiceImpl&quot;&gt;
  &lt;property name=&quot;userMapper&quot; ref=&quot;userMapper&quot; /&gt;
&lt;/bean&gt;</pre></div>
 
      <p>
         Una vez inyectado, el mapper est&#xe1; listo para se usado en la l&#xf3;gica de aplicaci&#xf3;n:
      </p>
         <div class="source"><pre class="prettyprint">public class FooServiceImpl implements FooService {

  private UserMapper userMapper;

  public void setUserMapper(UserMapper userMapper) {
    this.userMapper = userMapper;
  }

  public User doSomeBusinessStuff(String userId) {
    return this.userMapper.getUser(userId);
  }
}</pre></div>
       <p>
         Observa que no se usa la <tt>SqlSession</tt> ni ninguna otra referencia a MyBatis en este c&#xf3;digo. 
         No es necesario ni siquiera crear o cerrar la sesi&#xf3;n, MyBatis-Spring se encarga de ello.
       </p>

	<a name="register"></a><div class="section" id="register"><h3>Registrar un mapper<a name="Registrar_un_mapper"></a></h3>

	  <p>
	    La forma de registrar un mapper var&#xed;a seg&#xfa;n si quieres usar la configuraci&#xf3;n XML cl&#xe1;sica o la nueva Java Config de Spring 3.0+ 
	    (Tambi&#xe9;n conocida como @Configuration).</p>
	
      <div class="section"><h4>Con confiugraci&#xf3;n XML<a name="Con_confiugracin_XML"></a></h4>
      
      <p>
        Un mapper se registra en Spring incluyendo un <tt>MapperFactoryBean</tt> en tu fichero de configuraci&#xf3;n XML, de la siguiente forma:
      </p>
        <div class="source"><pre class="prettyprint">&lt;bean id=&quot;userMapper&quot; class=&quot;org.mybatis.spring.mapper.MapperFactoryBean&quot;&gt;
  &lt;property name=&quot;mapperInterface&quot; value=&quot;org.mybatis.spring.sample.mapper.UserMapper&quot; /&gt;
  &lt;property name=&quot;sqlSessionFactory&quot; ref=&quot;sqlSessionFactory&quot; /&gt;
&lt;/bean&gt;</pre></div>
   
      <p>
        Si el mapper UserMapper tiene un fichero XML de mapeo asociado el <tt>MapperFactoryBean</tt> 
        lo cargar&#xe1; autom&#xe1;ticamente. Por lo tanto no es necesario especificar dicho mapper en el fichero 
        de configuraci&#xf3;n de MyBatis a no ser que los ficheros XML est&#xe9;n en una lugar distinto del classpath.
        Ver la secci&#xf3;n de <tt>SqlSessionFactoryBean</tt> y la propiedad
        <tt><a href="factorybean.html">configLocation</a></tt>
        para m&#xe1;s informaci&#xf3;n.
      </p>

      <p>
        El <tt>MapperFactoryBean</tt> requiere o un 
        <tt>SqlSessionFactory</tt> o un <tt>SqlSessionTemplate</tt>.
        Ambos se pueden informar usando sendas propiedades <tt>sqlSessionFactory</tt> y
        <tt>sqlSessionTemplate</tt>.
        Si ambas propiedades han sdo informadas la <tt>SqlSessionFactory</tt> se ignora.
        Dado que un <tt>SqlSessionTemplate</tt> debe tener un session factory
        dicho factory se usar&#xe1; por el <tt>MapperFactoryBean</tt>.
      </p>
      
       </div><div class="section"><h4>Con Java Config<a name="Con_Java_Config"></a></h4>

       <p>
         Cuando uses Java Config puedes obtener un mapper directamente desde un <tt>SqlSessionTemplate</tt> como sigue: 
       </p>
        
<div class="source"><pre class="prettyprint">    @Bean
    public SqlSessionFactory sqlSessionFactory() throws Exception {
      SqlSessionFactoryBean sqlSessionFactory = new SqlSessionFactoryBean();
      sqlSessionFactory.setDataSource(dataSource());
      return (SqlSessionFactory) sqlSessionFactory.getObject();
    }

    @Bean
    public UserMapper userMapper() throws Exception {
      SqlSessionTemplate sessionTemplate = new SqlSessionTemplate(sqlSessionFactory());
      return sessionTemplate.getMapper(UserMapper.class);
    }
</pre></div>

       <p>
         Ten en cuenta que no puedes devolver un mapper obtenido de la una <tt>SqlSession</tt> normal de MyBatis
         porque no ser&#xed;a thread safe y solo vivir&#xed;a hasta que la <tt>SqlSession</tt> que lo cre&#xf3; se cierre.
         Debes usar un  
         <tt><a href="sqlsession.html#SqlSessionTemplate">SqlSessionTemplate</a></tt> en su lugar, 
         como se muestra en el ejemplo.
       </p>
    </div></div>

    <a name="scan"></a><div class="section" id="scan"><h3>Escanear mappers<a name="Escanear_mappers"></a></h3>
      <p>
        No es necesario registrar los mappers uno por uno en el fichero XML de Spring. 
        En lugar de esto, puede dejar que MyBatis-Spring los busque en tu classpath.
      </p>
      
      <p>
        Hay tres formas distintas de hacerlo:
      </p>
      <ul>
        <li>Usando el elemneto <tt>&lt;mybatis:scan/&gt;</tt>.</li>
        <li>Usando la anotaci&#xf3;n <tt>@MapperScan</tt></li>
        <li>Usando un fichero cl&#xe1;sico XML de configuraci&#xf3;n de Spring y a&#xf1;adiendo el bean <tt>MapperScannerConfigurer</tt></li>
      </ul>
      
      <p>Tango <tt>&lt;mybatis:scan/&gt;</tt> como <tt>@MapperScan</tt> son caracter&#xed;sticas a&#xf1;adidas en MyBatis-Spring 1.2.0.
      <tt>@MapperScan</tt> requiere Spring 3.1+.</p> 

      <div class="section"><h4>&lt;mybatis:scan/&gt;<a name="amybatis:scan"></a></h4>
      
      <p>
        El elemento XML <tt>&lt;mybatis:scan/&gt;</tt> busca mappers de una forma muy similar a c&#xf3;mo
        <tt>&lt;context:component-scan/&gt;</tt> busca beans.
      </p>
      
      <p>A continuaci&#xf3;n se muestra un fichero XML de configuraci&#xf3;n:</p>

        <div class="source"><pre class="prettyprint">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
  xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
  xmlns:mybatis=&quot;http://www.mybatis.org/schema/mybatis&quot;
  xsi:schemaLocation=&quot;
  http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
  http://www.mybatis.org/schema/mybatis http://www.mybatis.org/schema/mybatis/mybatis-spring.xsd&quot;&gt;
 
  &lt;mybatis:scan base-package=&quot;org.mybatis.spring.sample.mapper&quot; /&gt;

&lt;/beans&gt;</pre></div>

      <p>
        La propiedad <tt>basePackage</tt> te permite indicar el paquete base donde residen tus mappers.
        Puedes indicar m&#xe1;s de un paquete usando un punto y coma o una coma como separador. Los mappers ser&#xe1;n buscados
        de forma recursiva comenzando en el/los paquetes especificados.
      </p>

      <p>
        F&#xed;jate que no es necesario indicar una <tt>SqlSessionFactory</tt> o
        <tt>SqlSessionTemplate</tt> porque el <tt>&lt;mybatis:scan/&gt;</tt>
        crear&#xe1; <tt>MapperFactoryBean</tt>s que pueden ser autowired. Pero si usas m&#xe1;s de un <tt>DataSource</tt> 
        el autowire puede que no te funcione. En este caso puedes usar las propiedades <tt>factory-ref</tt> or
        <tt>template-ref</tt> para indicar los beans correctos a utilizar.
      </p>
   
      <p>
        <tt>&lt;mybatis:scan/&gt;</tt> soporta el filtrado de mappers mediante una interfaz marcador o una anotaci&#xf3;n.
        La propiedad <tt>annotation</tt> especifica la anotaci&#xf3;n que se debe buscar.
        La propiedad <tt>marker-interface</tt> especifica la interfaz a buscar. 
        Si se indican ambas se a&#xf1;adir&#xe1;n todos los mappers que cumplan <b>cualquier</b> criterio.
        Por defecto ambas propiedades son null asi que todos los interfaces de los paquetes base ser&#xe1;n cargados como mappers.
      </p>

      <p>
        Los mappers descubiertos ser&#xe1;n nombrados usando la estrat&#xe9;gia de nombres por defecto de Spring para los componentes
        autodetectados (ver la secci&#xf3;n 3.14.4 del manual de Spring).
        Es decir, si no se encuentra ninguna anotaci&#xf3;n, se usar&#xe1; el nombre no cualificado sin capitalizar del mapper.
        Pero si se encuentra una anotaci&#xf3;n @Component o JSR-330 @Named se obtendr&#xe1; el nombre de dicha anotaci&#xf3;n.
        F&#xed;jate que puedes usar como valor de la <tt>annotation</tt> el valor <tt>org.springframework.stereotype.Component</tt>,
        <tt>javax.inject.Named</tt> (if you have JSE 6) o una anotaci&#xf3;n propia
        (que debe ser a su vez anotada) de forma que la anotaci&#xf3;n har&#xe1; las veces de localizador y de proveedor de nombre.
      </p>

      <p>
        <span class="label important">NOTE</span> <tt>&lt;context:component-scan/&gt;</tt> 
        no puede encontrar y registrar mappers. Los mappers son interfaces y, para poderlos registrar en Spring,
        el scanner deben conocer c&#xf3;mo crear un <tt>MapperFactoryBean</tt> para cada interfaz encontrado.
      </p>

      </div><div class="section"><h4>@MapperScan<a name="aMapperScan"></a></h4>
      
      <p>
        Si usas la Java Configuration de Spring (@Configuration) posiblemente prefieras usar 
        <tt>@MapperScan</tt> en lugar de <tt>&lt;mybatis:scan/&gt;</tt>.  
      </p>
      
      <p>La anotaci&#xf3;n <tt>@MapperScan</tt> se usa de la siguiente forma:</p>
   
   <div class="source"><pre class="prettyprint">@Configuration
@MapperScan(&quot;org.mybatis.spring.sample.mapper&quot;)
public class AppConfig {

  @Bean
  public DataSource dataSource() {
    return new EmbeddedDatabaseBuilder().addScript(&quot;schema.sql&quot;).build()
  }

  @Bean
  public SqlSessionFactory sqlSessionFactory() throws Exception {
    SqlSessionFactoryBean sessionFactory = new SqlSessionFactoryBean();
    sessionFactory.setDataSource(dataSource());
    return sessionFactory.getObject();
  }
}
</pre></div>
	
	  <p>
	   La anotaci&#xf3;n fucniona exactamente igual que <tt>&lt;mybatis:scan/&gt;</tt> que hemos visto en la secci&#xf3;n anterior.
	   Tambi&#xe9;n te permite especificar un interfaz marcador o una anotaci&#xf3;n mediante sus propiedades 
	   <tt>markerInterface</tt> y <tt>annotationClass</tt>. 
	   Tambien puedes indicar una <tt>SqlSessionFactory</tt> o un <tt>SqlSessionTemplate</tt> espec&#xed;ficos
	   mediante las propiedades <tt>sqlSessionFactory</tt> y <tt>sqlSessionTemplate</tt>.
	  </p>
     
      </div><div class="section"><h4>MapperScannerConfigurer<a name="MapperScannerConfigurer"></a></h4>
        
      <p>
        <tt>MapperScannerConfigurer</tt> es un <tt>BeanDefinitionRegistryPostProcessor</tt> 
        que se puede incluir como un bean normal en el fichero cl&#xe1;sico XML de configuraci&#xf3;n de Spring.
        Para configurar un <tt>MapperScannerConfigurer</tt> a&#xf1;ade lo siguiente al fichero de configuraci&#xf3;n de Spring:
      </p>
        <div class="source"><pre class="prettyprint">&lt;bean class=&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;&gt;
  &lt;property name=&quot;basePackage&quot; value=&quot;org.mybatis.spring.sample.mapper&quot; /&gt;
&lt;/bean&gt;</pre></div>

      <p>
        Si quieres indicar un <tt>sqlSessionFactory</tt> o un <tt>sqlSessionTemplate</tt>
        observa que se requeiren <b>los nombres de los beans</b> y no sus referencias
        por ello se usa el atributo <tt>value</tt> en lugar del habitual <tt>ref</tt>:
      </p>
      <div class="source"><pre class="prettyprint">&lt;property name=&quot;sqlSessionFactoryBeanName&quot; value=&quot;sqlSessionFactory&quot; /&gt;</pre></div>
    
      </div></div>
    </div>
  

                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
              <div class="row span12">Copyright &copy;                    2010-2013
                        <a href="http://www.mybatis.org/">MyBatis.org</a>.
            All Rights Reserved.      
                    
      </div>

        
        
                </div>
    </footer>
  </body>
</html>
